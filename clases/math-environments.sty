\ProvidesPackage{math-environments}

% --------- Package dependencies ---------

\usepackage{empheq}

\usepackage{mdframed}
\usepackage{xcolor}
\usepackage{etoolbox}
\usepackage{tikz,float}
\usetikzlibrary{babel}


% --------- Mdframed template ---------

\mdfsetup{
  frametitlealignment=\raggedright,
  linewidth=2pt,
  topline=false,rightline=false,bottomline=false,
  frametitleaboveskip=0,
  innertopmargin=2pt,
  innerbottommargin=2pt,
  innerleftmargin=6pt,
  innerrightmargin=0pt,
}


% --------- Colors ---------

% -- Frame
\definecolor{DefinitionFrameColor}{HTML}{40a02b}      % Green
\definecolor{PropositionFrameColor}{HTML}{209fb5}     % Sapphire
\definecolor{TheoremFrameColor}{HTML}{04a5e5}         % Sky
\definecolor{CorollaryFrameColor}{HTML}{179299}       % Teal
\definecolor{LemaFrameColor}{HTML}{7287fd}            % Lavender
\definecolor{AffirmationFrameColor}{HTML}{dc8a78}     % Rosewater
\definecolor{DemonstrationFrameColor}{HTML}{4c4f69}   % Text
\definecolor{SolutionFrameColor}{HTML}{4c4f69}        % Text
\definecolor{ExampleFrameColor}{HTML}{df8e1d}         % Yellow
\definecolor{ExerciseFrameColor}{HTML}{fe640b}        % Peach
\definecolor{QuestionFrameColor}{HTML}{179299}        % Teal
\definecolor{ObservationFrameColor}{HTML}{d20f39}     % Red
\definecolor{NotationFrameColor}{HTML}{e64553}        % Maroon
\definecolor{ReminderFrameColor}{HTML}{e64553}        % Maroon

% \colorlet{ProofFrameColor}{black}

% \definecolor{ExampleColor}{HTML}{FFE3A9}
% \colorlet{ExerciseColor}{black}
% \colorlet{SolutionColor}{black!60}

% -- Text
\definecolor{DefinitionFontColor}{HTML}{000000}
\definecolor{PropositionFontColor}{HTML}{000000}
\definecolor{TheoremFontColor}{HTML}{000000}
\definecolor{CorollaryFontColor}{HTML}{000000}
\definecolor{LemaFontColor}{HTML}{000000}
\definecolor{AffirmationFontColor}{HTML}{000000}
\definecolor{DemonstrationFontColor}{HTML}{dce0e8}    % Crust
\definecolor{SolutionFontColor}{HTML}{dce0e8}         % Crust
\definecolor{ExampleFontColor}{HTML}{000000}
\definecolor{ExerciseFontColor}{HTML}{000000}
\definecolor{QuestionFontColor}{HTML}{000000}
\definecolor{ObservationFontColor}{HTML}{000000}
\definecolor{NotationFontColor}{HTML}{000000}
\definecolor{ReminderFontColor}{HTML}{000000}

% -- Background
\definecolor{DefinitionBgColor}{HTML}{FFFFFF}
\definecolor{PropositionBgColor}{HTML}{FFFFFF}
\definecolor{TheoremBgColor}{HTML}{FFFFFF}
\definecolor{CorollaryBgColor}{HTML}{FFFFFF}
\definecolor{LemaBgColor}{HTML}{FFFFFF}
\definecolor{AffirmationBgColor}{HTML}{FFFFFF}
\definecolor{DemonstrationBgColor}{HTML}{FFFFFF}
\definecolor{SolutionBgColor}{HTML}{FFFFFF}
\definecolor{ExampleBgColor}{HTML}{FFFFFF}
\definecolor{ExerciseBgColor}{HTML}{FFFFFF}
\definecolor{QuestionBgColor}{HTML}{FFFFFF}
\definecolor{ObservationBgColor}{HTML}{FFFFFF}
\definecolor{NotationBgColor}{HTML}{FFFFFF}
\definecolor{ReminderBgColor}{HTML}{FFFFFF}


% --------- Environment definitions ---------

\newenvironment{templateFrame}[6][]
{
  \mdfsetup{
    frametitle={
      \hspace{-16pt}
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[rectangle,color=#4,fill=#5]
      {#2\ifstrempty{#3}{}{~#3}:\ifstrempty{#1}{}{~(#1)}};
    },
    linecolor=#5,
    backgroundcolor=#6,
  }
  \begin{mdframed}[]\relax
}{
  \end{mdframed}
}

% Black and white frame
\newenvironment{bwframe}[2][]
{
  \mdfsetup{
    frametitlealignment=\raggedright,
    frametitleaboveskip=0,
    frametitle={
      \hspace{-16pt}
      \tikz[baseline=(current bounding box.east),outer sep=0pt]
      \node[rectangle, draw=black, line width=1pt, color=black]
      {#2\ifstrempty{#1}{}{~(#1)}};
    },
    topline=false,bottomline=false,rightline=false,
    linewidth=1pt,
  }
  \begin{mdframed}[]\relax
  }{
  \end{mdframed}
}

% Definición
\newcounter{DefinitionCounter}[section]
\newenvironment{definicion}[1][]
{
  \refstepcounter{DefinitionCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Definición \theDefinitionCounter}
  }{
    \begin{templateFrame}[#1]{Definición}{\theDefinitionCounter}{DefinitionFontColor}{DefinitionFrameColor}{DefinitionBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Proposición
\newcounter{PropositionCounter}[section]
\newenvironment{prop}[1][]
{
  \refstepcounter{PropositionCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Proposición \thePropositionCounter}
  }{
    \begin{templateFrame}[#1]{Proposición}{\thePropositionCounter}{PropositionFontColor}{PropositionFrameColor}{PropositionBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Teorema
\newcounter{TheoremCounter}[section]
\newenvironment{teorema}[1][]
{
  \refstepcounter{TheoremCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Teorema \theTheoremCounter}
  }{
    \begin{templateFrame}[#1]{Teorema}{\theTheoremCounter}{TheoremFontColor}{TheoremFrameColor}{TheoremBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Corolario
\newcounter{CorollaryCounter}[section]
\newenvironment{corolario}[1][]
{
  \refstepcounter{CorollaryCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Corolario \theCorollaryCounter}
  }{
    \begin{templateFrame}[#1]{Corolario}{\theCorollaryCounter}{CorollaryFontColor}{CorollaryFrameColor}{CorollaryBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Lema
\newcounter{LemaCounter}[section]
\newenvironment{lema}[1][]
{
  \refstepcounter{LemaCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Lema \theLemaCounter}
  }{
    \begin{templateFrame}[#1]{Lema}{\theLemaCounter}{LemaFontColor}{LemaFrameColor}{LemaBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Afirmación
\newcounter{AffirmationCounter}[section]
\newenvironment{aff}[1][]
{
  \refstepcounter{AffirmationCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Afirmación}
  }{
    \begin{templateFrame}[#1]{Afirmación}{\theAffirmationCounter}{AffirmationFontColor}{AffirmationFrameColor}{AffirmationBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Demostración
\newenvironment{dem}[1][]
{
  \siimprimir{
    \begin{bwframe}[#1]{Demostración}
  }{
    \begin{templateFrame}[#1]{Demostración}{}{DemonstrationFontColor}{DemonstrationFrameColor}{DemonstrationBgColor}
  }
}{
  \hfill\break
  \vspace{-.3ex}
  \hfill\(\qed\)

  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Solución
\newenvironment{sol}[1][]
{
  \siimprimir{
    \begin{bwframe}[#1]{Solución}
  }{
    \begin{templateFrame}[#1]{Solución}{}{SolutionFontColor}{SolutionFrameColor}{SolutionBgColor}
  }
}{
  \hfill\break
  \vspace{-.3ex}
  \hfill\(\blacksquare\)

  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Ejemplo
\newcounter{ExampleCounter}[section]
\newenvironment{ejemplo}[1][]
{
  \refstepcounter{ExampleCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Ejemplo \theExampleCounter}
  }{
    \begin{templateFrame}[#1]{Ejemplo}{\theExampleCounter}{ExampleFontColor}{ExampleFrameColor}{ExampleBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Ejercicio
\newcounter{ExerciseCounter}[section]
\newenvironment{ejercicio}[1][]
{
  \refstepcounter{ExerciseCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Ejercicio \theExerciseCounter}
  }{
    \begin{templateFrame}[#1]{Ejercicio}{\theExerciseCounter}{ExerciseFontColor}{ExerciseFrameColor}{ExerciseBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Pregunta
\newcounter{QuestionCounter}[section]
\newenvironment{pregunta}[1][]
{
  \refstepcounter{QuestionCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Pregunta \theQuestionCounter}
  }{
    \begin{templateFrame}[#1]{Pregunta}{\theQuestionCounter}{QuestionFontColor}{QuestionFrameColor}{QuestionBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Observación
\newcounter{ObservationCounter}[section]
\newenvironment{obs}[1][]
{
  \refstepcounter{ObservationCounter}
  \siimprimir{
    \begin{bwframe}[#1]{Observación \theObservationCounter}
  }{
    \begin{templateFrame}[#1]{Observación}{\theObservationCounter}{ObservationFontColor}{ObservationFrameColor}{ObservationBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Notación
\newenvironment{notacion}[1][]
{
  \siimprimir{
    \begin{bwframe}[#1]{Notación}
  }{
    \begin{templateFrame}[#1]{Notación}{}{NotationFontColor}{NotationFrameColor}{NotationBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Recuerdo
\newenvironment{recuerdo}[1][]
{
  \siimprimir{
    \begin{bwframe}[#1]{Recuerdo:}
  }{
    \begin{templateFrame}[#1]{Recuerdo}{}{ReminderFontColor}{ReminderFrameColor}{ReminderBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Recuerdo
\newenvironment{nota}[1][]
{
  \siimprimir{
    \begin{bwframe}[#1]{Nota:}
  }{
    \begin{templateFrame}[#1]{Nota}{}{ReminderFontColor}{ReminderFrameColor}{ReminderBgColor}
  }
}{
  \siimprimir{
    \end{bwframe}
  }{
    \end{templateFrame}
  }
}

% Sistema de ecuaciones
\NewDocumentEnvironment{sistema}{b}{}{
  \begin{empheq}[left=\empheqlbrace]{equation}
    \begin{aligned}
      #1
    \end{aligned}
  \end{empheq}
}

\NewDocumentEnvironment{sistema*}{b}{}{
  \begin{empheq}[left=\empheqlbrace]{equation*}
    \begin{aligned}
      #1
    \end{aligned}
  \end{empheq}
}
